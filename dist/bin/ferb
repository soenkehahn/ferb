#!/usr/bin/env bash

set -o errexit

mkdir -p ~/.ferb/project

if [ ! -f ~/.ferb/project/node_modules/.bin/babel-node ]; then
  (cd ~/.ferb/project; yarn add babel-cli babel-plugin-transform-flow-strip-types) 1>&2
fi

if [ ! -f ~/.ferb/project/node_modules/.bin/flow ]; then
  (cd ~/.ferb/project; yarn add flow-bin) 1>&2
fi

if [ ! -f ~/.ferb/project/.flowconfig ]; then
  (cd ~/.ferb/project; flow init) 1>&2
fi

export NODE_PATH=~/.ferb/project/node_modules

cat $@ | (cd ~/.ferb/project; ./node_modules/.bin/flow check-contents) 1>&2

~/.ferb/project/node_modules/.bin/babel-node \
  --plugins 'transform-flow-strip-types' \
  $@
